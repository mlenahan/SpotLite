<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="assets/css/style.css">
    <title>Form</title>
</head>

<body>
    <header>
        <nav>

            <ul id="menu">

                <li id='site-name'>
                    <a href='results.html'>Song City</a>
                </li>

                <li>
                    <a href="https://github.com/mlenahan" target="_blank" rel="noopener"
                        aria-label="Visit my GitHub page (opens in a new tab)">GitHub<i class="fab fa-github"></i></a>
                </li>

                <li>
                    <a href="https://www.linkedin.com/in/michael-lenahan-84b445135/" target="_blank" rel="noopener"
                        aria-label="Visit my linkedin page (opens in a new tab)">LinkedIn<i
                            class="fab fa-linkedin"></i></a>
                </li>

                <li>
                    <a href="login.html">Login</a>
                </li>
            </ul>
        </nav>
    </header>

    <div class="music-form">
        <h1>Get New Songs!</h1>
        <h2>Fill in the form below to get suggestions of similar music!</h2>
        <div>
            <form id="login-form">
                <div>
                    <label for="artist">Artist</label>
                </div>
                <div>
                    <input type="text" id="artist" name="artistname" placeholder="Artist name..">
                </div>


                <div><label for="song">Song</label></div>
                <div><input type="text" id="song" name="songname" placeholder="Song name.."></div>

                <div><label for="genre">Genre</label></div>
                <div>
                    <select id="genre" name="genre">
                        <option value="techno">Techno</option>
                        <option value="rap">Rap</option>
                        <option value="house">House</option>
                    </select>
                </div>

                <div><input type="submit" value="Submit"></div>
            </form>
        </div>
    </div>
    <!-- font awesome script -->
    <script src="https://kit.fontawesome.com/c7dbda0798.js" crossorigin="anonymous"></script>
    <script>
        function parseForm(form) {
            /* Gets values from form and renames for querystring parameters */
            const seed_artists = form.elements['artistname'].value;
            const seed_tracks = form.elements['songname'].value;
            const seed_genres = form.elements['genre'].value;

            return {
                seed_artists,
                seed_tracks,
                seed_genres
            }
        }

        function handleSubmit(e) {
            // Default behaviour of form submit event is to reload page. Prevent this.
            e.preventDefault(); 
            // e.target refers to the element that fired the submit event, i.e. the form element.
            const form = e.target;
            const formData = parseForm(form);

            const recommendationsEndpoint = 'https://api.spotify.com/v1/recommendations'
            // convert form data to query string parameters, e.g. 
            // seed_artists=skepta&seed_tracks=shutdown&seed_genres=rap
            const searchParams = new URLSearchParams(formData).toString();
            const fullUrl = recommendationsEndpoint + '?' + searchParams;

            // pop smoke - 0eDvMgVFoNV3TpwtrVCoTj
            // song - 6Juv5N0dNU1imms9c9u1dA

            // headers are passed with request. We need authorisation header (token) to authenticate with Spotify
            const headers = new Headers();
            const token =
                'Bearer BQCKD9q4VODBxRHB8H0ZMtYWQpyz7Bfr_VXwL8Y4nBgL4pLaJ6iYcaJTULLa-ux8j5jUby7zSaN1K79V4JrqKyZWeNfzj2M-WsleZJY5goGxVRvhhsvngjMUvpANWvqYSHXwo1ATlpSc6sbRqKRiUCACgSSch40XnDlpsfdWjhoNEG0H6pWuhIhI3bYoeh2LdOcmhUS36nfh5rQw2I9lK8NrXyrAfQK5PG7-TB6JSPaZWAbFXqkyauWD8iiXmNbZMzRlQdv-VTvbHlwtFlU-ke_m7wTl-oGo-uIGjDhNA16SXcA'
            headers.append('Authorization', token);
            // call the url with headers
            fetch(fullUrl, {
                headers
            })
        }

        const form = document.getElementById('login-form');
        // add custom form submit handler
        form.onsubmit = handleSubmit;
    </script>
</body>

</html>
